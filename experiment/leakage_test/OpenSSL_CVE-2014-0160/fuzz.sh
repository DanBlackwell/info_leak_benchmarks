#!/bin/bash

IN_DIR=IN
if ! [[ -z "${VANILLA}" ]]; then
  IN_DIR=IN_VANILLA
fi

re='^[0-9]+$'
if ! [[ $1 =~ $re ]] || [ $# -ne 1 ]; then
  echo "Usage: `basename $0` [number_of_seconds_to_run_AFL_for]"
  exit 0
fi

/usr/bin/time -v timeout $1 afl-fuzz -i $IN_DIR -o OUT -- ./fuzz > fuzzing.log 2>&1 &
cp fuzzing.log ../results/$(basename $PWD)_fuzzing.log

wait
