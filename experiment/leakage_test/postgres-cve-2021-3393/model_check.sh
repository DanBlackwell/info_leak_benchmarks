#!/bin/bash

touch logfile
chmod 666 logfile
touch fuzzing.log
chmod 666 fuzzing.log
mkdir -p OUT
chown -R postgres OUT
su postgres -c "export PATH=$PATH:/usr/local/pgsql/bin/ && \
        export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/pgsql/lib && \
        initdb -D /dev/shm/pgsql_data && \
        postgres -D /dev/shm/pgsql_data > logfile 2>&1 &"
su postgres -c "export PATH=$PATH:/usr/local/pgsql/bin/ && \
        export LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/usr/local/pgsql/lib && \
	      /usr/bin/time -v timeout $1 cbmc test --unwind 4000 > model_check.log 2>&1"
cp model_check.log ../results/$(basename pwd)_model_check.log
